CREATE OR ALTER PROCEDURE [dbo].[sp_Business]
    @Action NVARCHAR(20),
    @Id BIGINT = NULL,
    @OwnerUserId UNIQUEIDENTIFIER = NULL,
    @Name NVARCHAR(200) = NULL,
    @Description NVARCHAR(MAX) = NULL,
    @Website NVARCHAR(200) = NULL,
    @Category NVARCHAR(100) = NULL,
    @Phone NVARCHAR(50) = NULL,
    @Email NVARCHAR(100) = NULL,
    @IsVerified BIT = NULL,
    @Status TINYINT = NULL,
    @AvgRating DECIMAL(5,2) = NULL,
    @ReviewCount INT = NULL,
    @CreatedAt DATETIME = NULL,
    @UpdatedAt DATETIME = NULL
AS
BEGIN
    SET NOCOUNT ON;

    IF @Action = 'GET'
    BEGIN
        SELECT * FROM Business WHERE Id = @Id;
    END

    IF @Action = 'GET_ALL'
    BEGIN
        SELECT * FROM Business;
    END

    IF @Action = 'POST'
    BEGIN
        INSERT INTO Business (
            OwnerUserId, Name, Description, Website, Category,
            Phone, Email, IsVerified, Status, AvgRating, ReviewCount,
            CreatedAt, UpdatedAt
        )
        VALUES (
            @OwnerUserId, @Name, @Description, @Website, @Category,
            @Phone, @Email, ISNULL(@IsVerified,0), ISNULL(@Status,1),
            ISNULL(@AvgRating,0), ISNULL(@ReviewCount,0),
            GETDATE(), NULL
        );

        SET @Id = SCOPE_IDENTITY();
    END

    IF @Action = 'PUT'
    BEGIN
        UPDATE Business
        SET Name = @Name,
            Description = @Description,
            Website = @Website,
            Category = @Category,
            Phone = @Phone,
            Email = @Email,
            IsVerified = @IsVerified,
            Status = @Status,
            AvgRating = ISNULL(@AvgRating, AvgRating),
            ReviewCount = ISNULL(@ReviewCount, ReviewCount),
            UpdatedAt = GETDATE()
        WHERE Id = @Id;
    END

    IF @Action = 'DELETE'
    BEGIN
        DELETE FROM Business WHERE Id = @Id;
    END
END
